#!/usr/bin/python

############################################################
#### ITEAM INSTALLER
#### COPYRIGHT 2007 Adam Blackburn
#### AVAILABLE UNDER THE GPLv2.1
#### 
############################################################

import os,sys,Queue,threading,time,gobject
if __name__ == '__main__':
	#move to the directory this file is currently in
	os.chdir(os.path.dirname(os.path.normpath(os.path.join(os.getcwd(),sys.argv[0]))))
try:
	import pygtk
	pygtk.require('2.0')
except:
	pass
try:
	import gtk, gtk.glade
except:
	print 'Missing GTK and gtk.glade.  Aborting.'
	sys.exit(1)
gtk.gdk.threads_init()

#embed the glade file
glade_file = """<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE glade-interface SYSTEM "glade-2.0.dtd">
<!--Generated with glade3 3.2.2 on Thu Jul 26 12:06:38 2007 by adam@adam-->
<glade-interface>
  <widget class="GtkWindow" id="window1">
    <property name="visible">True</property>
    <property name="events">GDK_POINTER_MOTION_MASK | GDK_POINTER_MOTION_HINT_MASK | GDK_BUTTON_PRESS_MASK | GDK_BUTTON_RELEASE_MASK</property>
    <property name="border_width">6</property>
    <property name="title" translatable="yes">iteam installer</property>
    <property name="window_position">GTK_WIN_POS_CENTER_ALWAYS</property>
    <property name="gravity">GDK_GRAVITY_CENTER</property>
    <signal name="destroy" handler="quit"/>
    <child>
      <widget class="GtkVBox" id="vbox1">
        <property name="visible">True</property>
        <property name="events">GDK_POINTER_MOTION_MASK | GDK_POINTER_MOTION_HINT_MASK | GDK_BUTTON_PRESS_MASK | GDK_BUTTON_RELEASE_MASK</property>
        <child>
          <widget class="GtkImage" id="image1">
            <property name="visible">True</property>
            <property name="events">GDK_POINTER_MOTION_MASK | GDK_POINTER_MOTION_HINT_MASK | GDK_BUTTON_PRESS_MASK | GDK_BUTTON_RELEASE_MASK</property>
            <property name="pixbuf">iteam-installer-png.png</property>
          </widget>
        </child>
        <child>
          <widget class="GtkTable" id="table1">
            <property name="visible">True</property>
            <property name="events">GDK_POINTER_MOTION_MASK | GDK_POINTER_MOTION_HINT_MASK | GDK_BUTTON_PRESS_MASK | GDK_BUTTON_RELEASE_MASK</property>
            <property name="n_rows">3</property>
            <property name="n_columns">1</property>
            <child>
              <widget class="GtkButton" id="btndownload">
                <property name="visible">True</property>
                <property name="can_focus">True</property>
                <property name="receives_default">True</property>
                <property name="events">GDK_POINTER_MOTION_MASK | GDK_POINTER_MOTION_HINT_MASK | GDK_BUTTON_PRESS_MASK | GDK_BUTTON_RELEASE_MASK</property>
                <property name="label" translatable="yes">download</property>
                <property name="response_id">0</property>
                <signal name="clicked" handler="download"/>
              </widget>
            </child>
            <child>
              <widget class="GtkButton" id="btncompile">
                <property name="visible">True</property>
                <property name="can_focus">True</property>
                <property name="receives_default">True</property>
                <property name="events">GDK_POINTER_MOTION_MASK | GDK_POINTER_MOTION_HINT_MASK | GDK_BUTTON_PRESS_MASK | GDK_BUTTON_RELEASE_MASK</property>
                <property name="label" translatable="yes">compile</property>
                <property name="response_id">0</property>
                <signal name="clicked" handler="compile"/>
              </widget>
              <packing>
                <property name="top_attach">1</property>
                <property name="bottom_attach">2</property>
              </packing>
            </child>
            <child>
              <widget class="GtkButton" id="btnrun">
                <property name="visible">True</property>
                <property name="can_focus">True</property>
                <property name="receives_default">True</property>
                <property name="events">GDK_POINTER_MOTION_MASK | GDK_POINTER_MOTION_HINT_MASK | GDK_BUTTON_PRESS_MASK | GDK_BUTTON_RELEASE_MASK</property>
                <property name="label" translatable="yes">run</property>
                <property name="response_id">0</property>
                <signal name="clicked" handler="run"/>
              </widget>
              <packing>
                <property name="top_attach">2</property>
                <property name="bottom_attach">3</property>
              </packing>
            </child>
          </widget>
          <packing>
            <property name="position">1</property>
          </packing>
        </child>
        <child>
          <widget class="GtkProgressBar" id="progressbar">
            <property name="visible">True</property>
            <property name="events">GDK_POINTER_MOTION_MASK | GDK_POINTER_MOTION_HINT_MASK | GDK_BUTTON_PRESS_MASK | GDK_BUTTON_RELEASE_MASK</property>
            <property name="fraction">0.0099999997764825821</property>
            <property name="pulse_step">0.05000000074505806</property>
            <property name="text" translatable="yes"></property>
          </widget>
          <packing>
            <property name="padding">7</property>
            <property name="position">2</property>
          </packing>
        </child>
      </widget>
    </child>
  </widget>
</glade-interface>"""

iteam_png = """\x89PNG\r\n\x1a\n\x00\x00\x00\rIHDR\x00\x00\x01^\x00\x00\x00\x96\x08\x06\x00\x00\x01\xe1\xe0\xd0\xe1\x00\x00\x00\x06bKGD\x00\xff\x00\x00\x00\x003\'|\xf3\x00\x00\x00\tpHYs\x00\x00\x0b\x13\x00\x00\x0b\x13\x01\x00\x9a\x9c\x18\x00\x00\x00\x07tIME\x07\xd7\x07\x1a\x029\x02\xade\xd5$\x00\x00\x00\x1dtEXtComment\x00Created with The GIMP\xefd%n\x00\x00\x13zIDATx\xda\xed\x9d{\xb0U\xd5}\xc7?\x97\xf7\x15\x14A\x10\xe4\xa9\x02\x9a\xda\xaa\xa4\x02j,\x1a5\x8eh\x83\xf1\x11\xabU1\xd1NS\x8d\x8f\xa9\x19M\xa4S\x8c\xd1\xc4\xb6N5\xa3}\x98\x18\xeb\x8c\xc9\x98\x89\xd5(c&\n\xa9\x9a\x8a\x82U$\x81hD\x10\xf1\x81D\x14A\xde\x08\x02\xa7\x7f\xacu\xeb\xe9\xf5\xec\xc7\xdak\xed\xc79\xe7\xfb\x99Y\x03\xf7\xec\xbd\xd6\xfe\xad\xdf\xfa\xed\xdf^\xef\x05B\xb4\x185\xa8\xd5\xa0\xd6\xe4y\xa8\x0e=\x9aM{=\x12L\xa2\xfe\xdfzM/\xad\xfb\xad\x16S2\xf5\xa1\xa3\xee\xda\xec\x06iw\xfd=,.\xed\x1e\x19M\xe43\xc0\xaf\x80}#\xcc\xa6\xeb\xefC\x80\x93\xed\xff\xf7D\xa4u\x16\xf0\x8c\xfd{\x14\xb0\x06\x18\xed\xf3\xd2\xd5R\xd8\xf4\x8f\xea~_\x19qO-B\xc3D\x94"\t%\x98J\xe0\x7foP\xd4I\xa6qI\x83\xeb\x99\x05\xee\xe5h\x0e3\xca\xf6,\xae6\xdce[\x1d\x11\xa1^\xd8F\xd7\xfa\x16-\xf0\x86\x18\xbb\xae\xa5\xd0\xf8Q\xbe\x02\xf7r,\xe2.m5\x12\xb0\xa3\xee\xdf\xa8\x0c\xcc\xef\xe6\xde\x84\x10B\xb4B\x13\xa9\xdbOo4[\xf3HM\xa4\xe0M\xa4\x06\x15\x9cZL\xf3\xe7\xe3\x06\xe9>\x9cPW\x8ej\x1e\x91\xa2~\x1d+p\\\x82\x13\x80\xdbc\xae?a\x15\x92$\xd4\xa0n\x7fo\x06\xc6\xa5\x16\xba\xd68\xe1\xfa\xbf\x1fK\xa8\xb0\xd7R\xbc\x0bQZ\x1f\xe3\xdc\x10H!pTx0E\xeb9)S\x14)\xf0f{\xcf\xd4\x14m\xbeB\x05\xfe^\nW80\x85I\x14\xaa\xe1\x106\x9cI\xe0$?\xbc\xb1A\x13\x89\x18sH\xd3\xeb#\x84\x10B\x08Q\xdd&\x7f\xcc\xc8\xe8\x98*\xb6\xaa\xabD\x87\xbf\xfe\x83\xa5\xd5\x92\xf4\x90\nJVp\x84\x8b\x88\x1b\xae\xac%\xb4\xf1]\x87P]\xd3\xa8\x01\xc76\x88?\xbb\xdbs\xd2\xc8r\xad\xa7\xcc\xde>8\xe9A\x9b\xeb\xaeO\x8fy\xccp\x87\x02J[\x08q\n\xae\x01\xa74\xb8\xa7wJ\x05>Qw}a\x99\nv-\xe5\xae\xfb\x07x|\x13\xd2(\xf8\xf0\x8ci8\xdf\x97\xa7\x0f~\xdf\xc3E\xac\x8eI3\xc4\xeb\xfaR+|\xe4\xe6w\xaba\xb8\x84\xa8\x1e\xc4\xa1\xf6\xef\xed\xc0\xe54\x9e\x88\xd1R\xf5`\x97\xe9_I\x0c\xa9\xbbwV\xc64\xea\xef\x1d\x9e\xf0\x91+\xc4E\x84T\xf0\xab\x11oD\xf7\xd7x\x0fp4\xd0\x0f\xb8\xac\xc1\xf5\x9fw\x8b?\xaf\xdb\xf5\xd5\xc0A\xd6\xcao\x8cq\x17\x7f\xdf\n\n\xc6\xc1\x17~\x90\xe0?\x07{T\xd3\xbe\x99"\xe3\xd5T\xb0\x10B\x08!\x84\x10B\x08!\x84\x03\xb1}\xa4\xf5\x1d8\x1d\x1a\x15v\xc6\xb73]=E9"\xe5\xe6h\xb9B\xca\x95r\xdbK\xb91\xc3>Y\x16R\xc5\r\xdd\x8ct\xf4\xf1QaU\xca\xb8`\xb6\xb2h\x94\xc6E)\x9f9\xdc\xf7k\x95\xa4\xdc4cj/\x92n^\xc3\x8e\x18Q\x1e\xc3m\xfaS\x92roL\x88?>ea\xf6(S\xb9\xdfop\xfd\x1c\xa0\x0fp\x1c\xb0\xab\xdb\xb5\x15\x11u\xf1\xeei\xcc\xc0\x8c*\xef\x07\xdc\xd5\xe0\xfa\x95)\xad~\x91M\xe3\xf8\x84<]\r\xf4\x04n#\xd4\xdc2\x87\xd1\xe0\xb4\xafb\x96\xfb\xea\xaf\r\x89Ic%n\x93\x07\xd3\xb8\x9d\x17<\xf3\x95\x9br\x178\n\xd0u\xef6\x8f\x8c\xf8N\xfc\x9b\x96\xe1\xfbQ\x8ark\x19\x95[\xf3\xfbL\x04\x9bU\xf9z\xcc=\xcfP\xf2d=\x97\xaf|V\x85\x0e\x02\xe6\xe4\xd4R\xbc)\xe6\xda\xba4\t\xf4\xa2y\x18\x17\xf1\xc1\xcb\x8b\x8d\xbe\t4\x8br\x9b\xb2\xff\xa2(\xb7\xe0:\xc54I\xb1\x0f\x01GP\xf1)\xa6\xbd\x9a\xcc\x18:d\xb9\x86\xedu\xff\xbf%@ma\xaf\x84\xf8\x1bZU\xb9\x93\x12\x941\x93O\xb6\x9al\xc4\xce\x14_\xe2\xf51\xf1W\xf1\xe9\xd9\xea-\xa3\xdc\x85\xd6\x07vgy\xdd\xff\xbbV\xcb\xdc\x0e\xf4\xc7Ll^b\x7f\xeb]w_T+\xac\x9f\xbd\xf7\n\xa0\xd3>o\x93\xfdmT\xd3}\xed2N\x86>\xaf\xdb=[<;\\\xaeO\x19wQ\xe0F\xc4\x991\xf7\xa4\x9d\\\xed\xa5\xdc\xb3\x1ad\xf2\xd7\r\xee\xebLP\xcc\xd6\x04QNLY(\xf5{\xb0\x8e\xae\xb4r\x85\x10B\x08!\x84\x10B\x08!\x84\x10B\x08!\x84\x10B43^\x13\xb2\xa2\xc6\xe1\xb5xX\x14A\x15\x16\xff\xcdB\x13/D\x06\xca\x9c\xba+c\x15\xe5U\x1br0^U7DSU\x1b\x84\x90\xf1\n\x19\xaf\xcbw\xbf\xd6(\xc4T\x13\\W\xee\xfb4\xe4\xae\xc5\xec\xa3\x91\xb4\xe4\xe2\x01\xcc\x9a\x97\xbc8\x14\x98K\xfa\xe5#\x1fY\xd9\xb32\xdbA\x87\x97&\xc8\xf2\x03\x87\xe7~\x11\xb3\x8a.*\xadm\xc4\x9fJTx\xa5\xd5\xc7x}7`\xe9\xceU\x9e\xcf\xe8\n\xcfz\xaa\xe5\x92@r\xd4\x87/\x074\xde\xeff\x94\xe1\xe6\x06\xcf\xfa\xbaG\x9e\x8e\x96\xf1\xc2\xcb9\x18K\r\xb3Y\x8f\x0b7\xe4$\x87\xebK\x1ce\xbc\xe3\x03\xcapD\xa0\xb4\xdei\x16\xe3Mc\xcc.\x0c\x88Q\xca&\x92\x17n\xd7\x13\xb7\x15\xd7I)\xe2/\x8f\x89\x7f\xa2\x83\x1c=1k\xa5\xa3\xd2\xda\xe3a\xbc\xdd\xabJY\xca\xa7Q\xd8b\xe5\x8e\xe3\xde\x98\xf8_i7\xe3\xdd+"\xfeD\xcf,E\xbd\x10\xc7\xc5\xc497"\xcem\x01\xba\x12\xb3\xe8(\xcex\xefv\x94\xe1\xed\x80_\xa6\xd0m\x9a\xa65\xde\xbc\x15P\x05\x05\x876\xdeG\x0b\x96\xa3\x11kC\xea\xb6\x19\xbb\xcaN\xcf\xa1N\x9dF\x99W\x17\x94\xbf>\xc0\xad9\xa4{F\xc0\xb4\xfe9c\xbc\x85\x95\xb1\xa2\x92<\xef\xa2\x02\x1aF\x8d\xc2\xca\x8cj\x1a\x88\xd9Q\xf5\t`w\x01\x8d\xb6\xd9\x84\xfdr4J\xeb\xcc\x02\xba\xf1\x12i\xb6m\xc9\xbaZ\xbaep`\x8a{\xfaav\xf0\xea\x8b\xc8\x9df\xac6\xfc!\xe2\xf7\x8e\x9cC\x9c\xae\xc6Z\x0f\xb2\xdd\xc3p\xe7\x01_\xb5\xcf\xd1\x1c\x8f\x165\xde;*&\xcf\r\xc0\x9b1]Di_\x8e\x13\x80\xfbR|F5\xa4\xdf\x82\xbd\r\xb5\xf2\xd4\xf0\xa9\xf0]\xcf4\x07\xc6\xe4q\x1f\xd5y\xab\xf9\x16\xa7\x1dX8>F\xd1\x87\x94\xd4EU\xcf/=\x9e?\x87\xf8\x9do\x87#*i\xbc\xf3R\xde\xf7\x0c\xd1#W\xcb\xac\xb1-w\xa8;NO0\xd2\xfe\x8e\xf9X\x00\xacq\xb8\x7ff\xdd\xf3O\xadh\x83U\xd5\x86\x14\x1e\xaeQ88&\x9d\x9d\xe4\xd7=\x96\xe6|\x84\x0e\x8a\xed\xb2{R\xd5\x86\xf2=\xef\x10\x87{/\x8f\xb9\xd6\xc7\x1a\xd0C\x01e\x9bk\xd3\x1c\x98\xb2p;\x80\x9f\x06z\xf6\x91\xc4\x1f\xf7p\x92\xdcf\xf9\x9e\xb7\x8b\x9e\x98\x13\xb7\xe2\xbc\xcd\xa6\x0c\xe2]O\xba\xf9\xbc\xbb1#Z!\xbb\xa7\xa6\x03\x1f\x92n\xfa\xe5\xf8\x0c\x9eo\x89<\xaf\x10B\x08!\x84\x10B\x08!\x84\x10B\x08!\x84\x10B\x08!\x84\x10B\x08!\x84\x10B\x08!\x84\x10B\x08!\x84\x10\xa2u\x08~p\xb6\x0e\xcd\x16EQ\x95\xed\x9e\xba\xb6[\x12\xa2\x18\x02l8\xd2\x17s\xb8\x9c6\x9f\x10Me\xbc\x0f\xa3\x9dS\x84\x07\xbd\xca\xb3{!Jl\xb0\xe5`\xbcj\xec\x89\xa6k\xb0\t!\xe3\x152^!d\xbcB\xc8x\x85\x90\xf1\n\x19/N\x83\x14i\x07#B\x9d\xaf6\x06\x98O\xf2\xb6\xfa\x1f\x00g\xe7\xac\xe3o\x00\xebH\x7f`\xca<\xfc\x8e\xe3J\xbb\r\x7f\x7f\xfb\xac(96\x00\x93R>\xb3\x03x !_\x8fV\xcaYz\x18o\xe8\xc3\xa2\xbb8\xcf\xe3\x19\xf7\x05T\xcd\x14`W\x80|_\x9c\x93\xf1\xfe\xc6A\x86\xa4\xf3@\x1ew\xcc\xd3\x1c\x19\xef\xa7\xd9A\x98\xa3\xa2Fz\xaae\x1ba\x8f\xae\xda\x1c\xd8xC\x96\xc1\x9e\x82\xf2\xd4\xb2u\xde!V!}\x02\xa5\xf7\x0epN\x86x}\xac\x1c\x9d\x81\xf37\x00\xf88\x9c\xbf\xc9\xcc\x96\x06iux\xe4i^\xbb\x1b\xef@`m\x0e\xe9>\x04\x9c\xee\x18gG\x8e\xf9\xec\x859\xa0\xdb\x07_o\xd7\x1f\xf8|\xa0\xb4\x00\xa6\x02\xfd\xda\xb9\xda\x90\xa6Av\x0b0\x19\x18j\xbd\xe3\x81\xc0\x0c\xcc\x11\xabI\xf1\xd3\x1e\xdb\xba$!\x9d\xadV\x8e\xe3\xad\x1c=\xad\x87\xfe\x0c\xf07\xc0\xe2\x80\xd5\xa7F\xf1\x1e\x89\xf8\xfdf`\x82}9&\x00\xb30\xe7\xd2%\x9dY\xd7\xe8\xda\x83\xd6 \xfb[\xa7r&\xf0VB~\xe67\x83\xf1\xe6\xd1\xab\xf0fL:3\x1d\xd2\x99\xeci0=b\xe2\xaev\xcc\xd3\xa5\t\xb2\x0c\xf3\xd0\xadK\xbd\xfe\xdb\x0e\x8e\xe5\xca\x14\x1e\xbbF\xb8\x9e\xa4\xa67\xde\xa1\x11\xf1?\xf4\xc8\xce\xd3\x11i\x9e\x9b\x10/\xaa\x8b\xe8\xb5\x8cr\x0c\x8b\xd1\xcf\xad\x9e\xc6\xbb\xddA\x8e\xdf\xa70\xdc}\x1d\xaa\xa72^\xcb\xc6\x9cZ\xb0\x8b3\xc8\x95G\xa1\xbcD\xf4q\xaf>\xc6\xebB\xd2\x81\xe0\xc78\xa6\x17\xd5\xa5\xb6_\xbb\x19o\x9eop\xa3\xb4\xfb9\xde\x7f\x97\xa7\x0c\xa7F\xa4\xfb\x8e\x87no\x08\xa4\x8b\x1a\xa6\x0f\xdb\x95I\x11iMm\'\xe3mT/|>`\xb6\x1ay\xdf\x7f)X\xb5\xfby|\xf6C~\t\xa2F\x06g\x04t\x0c\xd3\xdb\xc9x\xdfm\x10\xef\xd8\x80\xd9\x9a\xde \xfd=\x05\xab\xb6wLk\xbfH\xe3]@uO\x90/m\r\x9b\x0f\xc3#\x94\x9c\'E.O:\x11\xb8;\xa6\xe1\x93\x85\xdfe\x8c\xf7~\x95\r\xa1\x19\x8d\xb7\x958\x0631hF\xc4K\x19\x8a\xa7[Qy2\xde\xfc\x99\n\x9co\xab#\xa3K\x92a\x99\x8cW\xa4\xe5V\xe0\xba\n\xc9\xb3\xb6\x15\x95\xac\xc9\xe8a\xb9\xd96B\xae\xab\x98\\;\xe5yE\x1c\x1b\x81}\xa4\x06y^W\x0e\xb5=\x02y\x86\xa4\xcf\xb2\x8f\xe1\xae\x07\xee\x04\x0e\xb3\xcf\xea\x94i\xb6\x8f\xe7\xfds`yI\xcf\xbe\x063\xa78\x89%\xc0\\\xdb\xf2\x7f\x96\xf8\x15\n{\xcb4s\xa6\xa4A\x8aF\xf1V\x95\xab\x86\xc8!\xd4#3\xa6y\x84\x87\x8eB\x0e\x04\xcc\xa6\xc2\x83\x14\xadRm\x18U\xd2s\x8f\x8b\xf8}\x91\xfd\xaa-\xc9\x98\xee\xe9\x88\x964\xde\xa8\xd1\xa7KJ\x90\xe5\xfa\x88\xdf\'y\xa6\xfb\x1d\x99fk\x1a\xef5\x11\xbf\xdf\x1b(\xfd\xf5\x0e\x9f\xca\xe3r\xc8\xdfA\x84[\x8f\'\xe3\xcd\x01\x9f\x89.\xdb\x12Z\xfd>\\\x05\x0cj\xf0\xfb\xe2\x88\xfbC\xf7\nt\x02+e\x96\xd56\xde-\x9e\xf1\xcf\x8f\xf8}\x08f\x1a_\x16.\xc0tW\xb9x\xd8\x97#~\xcf\xd2P\x9b\x9a\xf0b\x8a\x8a\x18\xef\x9a\x88\xdf{\xa7\x8c\xff@\xcc\xa7|\xb0\xbd\xf6\x17)\xd3\xea\xc0,\xd9\xb9?\xe2\xfa\xea\x18\xa3\xba\'\xe2\xf7\xc5|\xb2\xd26\x89\xc1\xb6\xaa2O\xe6X \x1e]eQ\xabYk\xc0\x15\xa4\xeb\xe7\xdc\x8bt\x0b\x04_\xb0^\xf5\x00\xfb\xb2\x0e\xb5\x86u\x07aV\xec&\xc5\xbf\x1b3\xcdq\x08f\xd5\xf0(\xfbb\xcd&\x9f\rX\xda\xa6\xab\xac,\xe3\xbd2P\x81\x9dL\xd8\xddi\xba\x874\x9f\xffE9\xcb \xe3\xadX\xb5\xe1\x87\x81\xd2y\x128-\'\x19O&]?\xedQ9<\xfb\x10\xe0\xb1\x88kC\xf5\xcd/\xd7x?\xb6\xf5\xbc\x10\xcc\x89\xe8!\xf0a(\xf0\x94\xc3\xfd\xa1\x86\xd9\x17\xd6\xd5\xc1\xa3f\xa6]+\xb3-\xd7x\xc1,2\xdc\x1e(\xad\r\xb6\xd0gy\xa6s\xabM\xe7\x03\xc7x\xbb\xeb\x8c.\x0bkm\x1d~J\xddo\xafD\xdc\xfbM\x99m\xb9u\xdez."\xdc\x16\xa7\xf5\x9f\xdd4\xdb9\xd5l\xd5 \xe4\x02\xce\xde$\xefU[\xc3\xcc\xb1M\x9a\xf7\xfbE\xc2\xec#\xa1\x06\x9b\x10B\x08!\x84\x10B\x08!\x84\x10B\x08!\x84\x10B\x08!\x84\x10B\x08!\x84\x10B\x08!\x84\x10B\x08!\x84\x10B\x08!\x84\x10B\x08!\x84\x10B\x08!\x84\x10B\x08!\x84\x10B\x08!\x84\x10B\x08!\x84\x10B\x08!\x84\x10BT\x99\x8e\xb2\x1e\xecr2qG\x89r\n!DhzH\x05\x9f\xa2\x13\xb8Ij\x10B\xb4\x1c5\xa8\xa5\r\x05\x88s\x10\xf0\x0b#\xd6\xff\x05!\x84\x90\xe3\r\xcc4\xe0\xb5n\xceV\x8eW\x08!\xc7\x1b\xd8\xf1\xce\x04\xb6\xc68[9^!D\xee\xb4\xdb\xe0Z\xad\x19t#\x84\x90\xe3m\xb1\x8a\xb6t#\x84(\x17\xcdj\x10B\x089^!\x84\x90\xe3\x15B\x08!\xc7+\x84\x10r\xbcB\x08!R\xd2K*hZ\xfa\x01\x93\x81)\xc08\xe0``,\xb0\x0f\xd0\xdf\x86=\x98y\xcb[\x81u\xc0\x1b\xc0J`)0\x1fx\x95\xd6\x9b\xb3<\x168\n8\x14\x18\r\x8c\xb2a\x10f9x\xa7\xd5]O\xe0\xa3\xba\xb0\tx\x17\xf8\x83\rK\x81\xdf\x02\xaf\x00\x1f\xb7\xb0\x1d\x1d\x08L\xb5v\xf4\xa7\xc0\xfeVW\x03\x81m\xc0\x06\x1b^\x07\x16\xda0\x1f\xd8\x9e\xb3\\\x03\x81\x13\x80I\xd6\xce\xc7X\xb9\x06\xd9\xb2\xdbn\xcbl5\xf0\x16\xb0\x04x\x11x\xa6\x00\xd9\x9a\x97\x9c\x16P\xd4J\x0cy\xd1\x01|\t\x98g\x1di^\xf2o\x02\xee\xb4\x8e\xab\xea\x8c\xc2\xec\xa7\xb1\xa2\x84r~\x1e\xb8\x10\xe8]P^g;\xc8vf\x8a\x16\xee\xa5\xf6\xc3\x12J\x1f\x0f\x00#\x02\xe4\xf34\xfb\xa1\x0bYV\xaf\x01\xe7\xca\xdb\xca\xf1\xa6\xe50\xe0\xa9\x92\xf3\xb3\x19\xb8\xb6"\xad\xa21\xc0\xfd9\x7fx\xb2\x86\x85\xc0!\x15w\xbc\x17\x01[\n\xd0\xc5\xdf9\xe6m\x1a\xf0^A\xe5\xb4\xc6\xd6\xe8\xe5x\xe5x\xff\x1f{\x03\x0fV\xd0\xb1\xd4\x80\xb5\xc0\xc9%t\xa5\xdc[Q}4\n\xbb\x80\xf3+\xe6xo+I\x17I\xb5\xcc\xebK,\xa7\xf7l\xf7\x8a\x1co\x9b;\xde\x11\xc0\xef\x9b\xc8\xb9|5g\xd3\xe8\t<\xd2D\x0e\xb7{X\t\x0c(\xd9\xf1\x9eU\x81\xd6\xc1#\r\xf2r\x06\xb0\xbb"\xe5t\x99\x1co{:\xde^\xc0\x7f5\xa9s\xd9\x0cL\xcc\xc1,&c\x06\xb2jM\x1e6\xd9A\xa02\x1c\xef\x93\x15\xd2\xc3\xe36\x0f}+Z\xb9\xf8+9\xdebv\'\xab\xc2`\x19\xc0\x89\x1e5\x92\xcd\xc0}\xb6\xe9\xef3\x1dp_\xe0+\xc0\xd3\x1e\x86\xfb\x83\x80:\xf9K\xcf\x17\xfcK\xb6{\xc2\x97\x91\xc07\x80\xe5\x9e/\xf5\xa2\x12\x1coR\xd8\x0e\xdc\x91\xa1O\xfaH\xe0W\x1e5\xdf4\xb5\xdcW\xec\xc0\x9fK\x19\xf6\xb0\xdd;\xafy\xe8d\xa4\x1co{8\xde\x9b\x1c\xe5\xd8\x03\xdc\x03\x0c+\xa0X\xce\xc2L\xa9r\x91\xefE\xfc7\x14\x9a\x96\xe1\x85y\x0e\x18Z\x80N\x0e\x00^\xce\xf8R_X\x01\xc7\xbb\xdd~`Cqs\xc0\x0f\xc1R`B@\xd9\xb2\xf4i\xff\x87\x1co\xeb;\xde\xdb\x1d\x9e\xff.pxI\xc5\xd3\x89\xdb\xac\x8a\xdfy\xd6\xbc?rx\xd6N\xcc\xac\x8f\xa2\xf9r\x86\x97\xfa\xe7%;\xde\xb3r\xd2\xc5\xa9\x9e\x0ew\x050$\'\xd9\xfe\xc8\xb1\x1fy\x9b\x1cok;\xdeK\x0b\xae)\x85`\x8a\x83\x11\xff8\xe33\xeev\xd0\xcbF\xcc\xc4\xfa\xb2\xf8\'G\x1bz\xb5$\xc7\xbb\x0e3K&On\xcd\xe8t\xef)\xa0\x9c\xbe\xee(\xd3\x9f\xc8\xf1\xb6\xa6\xe3=\xc0\xa1O\xb7js\r\':\xe8\xec\xb4\x0c\xe9\x0f\xc0\xac\xbc\xfb\x1cp6p9p#p\x97\xed\x1f\\\x80Y5\xb5\xa5\x02\xba9\xc4\xd1\x86>,\xc1\xf1~D\xb8\x81\xbd8Fdp\xba\xbf,\xa8\x9c\xfa\xe36\x86r\x8a\x1cok:\xde\xb4\xf3s\xbfU\xd1\xe2\xba\xb1\xc0\x1a^\x95\xe9\xe1hC;Kp\xbc\x97\x17\xa8\x0f\x97\xbe\xef=\xc0\xf0\x02e{\x052\xcf\x7f\x96\xe3m\x01\xc7{\x80\xc33\x07W\xb4\xb8\\j7S[\xd8l\x07@a\xf3\xbb\xb38\xde\xed\x98y\xd0E1\x17\xbfy\xbdy\xf2D\x95\x1d\xaf6\xc9\xc9\x9f\x8b\x1d\xee]\xd7\x02\xf9=\x1b\xb3QI\xb32\x1c\xb31\xcb\x14\xe0\xcf\x80\xa3\x81\xbd\x9aD\xf69\x98>\xf9\xa2p\xd9\x8c\xa6h\x9b\xd8R\xe5\x82\x92\xe3\xcd\x9f\xcf\xb5Y~\x8f\xa9\x88\x1c}0\x1b\xfe\x1c\x84Y"\xda\x15\xc6\x01\xe3+\xdc\xba\xf0\xe17\x15\x96m\xb5\\\x81\x1co\x91Ll\xb3\xfc\x1eT\x80\xcd\x9e`\x9b\x87\x9f\x07\xfe\x18\x1dL\xda\xc5\xdb\x15\x96m\x87\x8aG\x8e\xb7H\x06\xb7Y~C\x8f\xa8\x8f\x03\xbe\r\\@\xb1\xfd\x97\xcd\xc8f\xa9@\x8eW\x18:\xdb,\xbf!j\x9f\x13\x80\x87\x80#d>N\xec\x91\n\xe4x\x85a=\xe9\x97\xb6\xeeM\xc5\x07\x05rf*f\xdf\x85\xfe\x15\x92\xe9C\xe0Y\xcc\xe63s1\xcb\\\x85\x90\xe3\xad8o;8\xdec0\xd3`\xda\x8d\x9e\xc0\xff`f\x13\xe4\xcdF\xe0M\xcc1H\xafc6XYn\x1d\xea\x9a\x14\x1fF!\xe4x\x9b\x80\xe70g\x80\xa5\xe1\xe26t\xbc\x830gfeujK\xad\xce\x16`F\xf5W\xe4\xd8\xe4\xce\xb2\xbf@\x07\xadw\xae\x9d\xf0D\xa7\x0c\xe7\x8f\xcb\xc4\xf1\x19\x94\xb3\x01LYt`\xf6iuq\xbaK1\xdb\x14v\xd8p\x18p5\xf03[s\xcd\xb3\x9f3\xcb\x0c\x15Un\x84\x1co\t<e\x9b\xb4i\x99\xdbF/\xebw0+\xfb\xd2\xb0\t3/\xf70\xfcvC\xf3!\xcbr\xdc\xdez\x05\x84\xbe\xc6\xe5p\r\xf0h\xca{G\x01\xcb0\xf3S?\xaa\x88\xfcW\x00\xb7`\xfa@\xbb\xc2{\x11\x7f\xbf\x879"(\r\x178\xc8p<\xe5\xceS\x9dE\xb6\xcdT:i\xb7\xad\x07\x85\x1c\xaf\xa7nv\x05J\xeb\x17\xc0O\x1d\x1c\xcd\xc1\x98\xd9\r\xa7\x00\xbf.Y\x0f?\xc1\x9cR\x0b\xb0\x0f\xc9\xa7\x17\x1cF\xfa\x91\xff\x03\x1d\xe4XUR\xfe\xfba\xfa\x8f?\x9b1\xfe\x00Zc)\xb8PWCf\\V\xcf\xec\x1f\xf8\xd9\x17bvsJKO\xdbM\xb1\x9a|\x8f\x0f\x8fb\x1a\xe6\xfc\xb3\x8b\x1c\xe2|\r\xb7\xe9V\xeb\x1d\xee\xfd^\xc1\xf9\x1f\x0c\xfc7f?\x82\xcfz\xa43\x08!\xda\xdc\xf1\xba\xec\x8fzz\x0e\xcf?\x02sT\x8e\x0b#l\xd7\xc3.\xe0\x1f0\x07\x07\xe6E\'\xf0\x8f\x98\x01\xaa\xc7\x1d[D\xdf\x02~\xe4\xf8\xbc\xb9\x0e\xf7^\x86\x99\xb10:\xc7\xfc\xef\x07\xfc\x9b\xd5\xf5:\xcc\xd2d_\xf6G\x88\xaaP\xd2\xb6\x90\xcf\xe1\xb6\xa5\xdf}\xe4\xb3\xf2\xec_\xf1?\xaf\xeaU\xe0oI?8\xd5\x88\x91\xc0U\xd6\xb1\xfb\xc8rN\xc6\xe7\x1fH\xf6C?\x1f\x05\x8e%\xfbJ\xb9\xde\xc0I\xc0\x0f1}\xb0y\x9dd\xfb5O[\xc9r\xbc{QH69\xdeT\xdc\x19\xe8e\xda\x8d\x19\xf8\xda`\xbb\x02\x96\xe3~\xc2\xed\xe1\x98\xc9\xfc\xcd|\x8c\xf9J\xcc\x99i>\x9c\xdd\xe4:H\nw\xc9\xb9I\xb6v\xefj\xf8Y@\xbd\xf5\xc5\x9c\xff5\x02\xb3\xb7\x80\xeb\xaa\xab\x97l\xfc\xf30}\xa9\xcd\xc4\x0e[[<\xd8~||x\xd8\xeanw\x13\xe4{\x0b\xe6\xc4\xde5\x0eq\xceP\xfbV\xb4\xbb\xe3]\x00\xdc\x91S\xda\x933\xc6\xfbO\xcc\xde\xb1S0+\xb8\xaa\xcc*\xeb$\xfb\x11v\xb6\xc5"L\x7f\xf2O*\x98\xe7]\x98~\xef~\x98\x85\x1e?\xb6-\xa7\xb4\x8c\x00\xa6\xcb\xd5\x88v\xeej\xe8\xe2\x0b\xb6\x96\x19\xb2Iy\x7f@\xf9\xce\xb3N\xb8\nM\xe5\xf5\x98\x13\x92\x8b\xa2\x03\xb3\xb0bO\x89y~\x07\xf8\xeb\x84\x8a\xc9\x12\x87\xf4|\x16|\xa89\xdf\x82]\r\xed\xeax\xbb\x98hk[!^\xd6e9\xc9\xd8i\x9d\xc0\xe2\x82\x9c\xce\x1b\xc0L\xd2o\xec\x93\'}1\x83\x7f\xabr\xce\xf3\xf3\x98}2\xfa:\xca\xf6\xba\xc33\xae\x93s\x93l\xf5\xb5\x0b\xf1\tc\x81\x93m\xb3\x7f\x1c\xe64\x85}1gn\xf5\xb5\xb5\xe4\xad\xc0\xfb\x98A\xb5\x15\xd6\xe1.\xc6l\xd0\xb2\xb1`\xa74\xd1vq\x8c\xb7\xb2\x8f\xc5l\xe4\xd2\xdf:\xec\xbe\xb6\xa9\xbc\xa3N\xee5\xb66\xbd\x14\xb3O\xc2\xf3\x05\xcb\xedKO\xcc\xa6C\x930\x03\x94\xe3ls~X]9\xd503\x15\xb6\xd9\x1a\xfb[\x98\x1d\xc9\x96\x01/\x00\xbf\xa5:\xab\x02\x85\x10B\x08!\x84\x10B\x08!\x84\x10B\x08!\x84\x10B\x08!\x84\x10B\x08!\x84\x10B\x08!\x84\x10B\x08!\x84\x10B\x08!\x84\x10B\x08!\x84\x10B\x08!\x84\x10\xc5\xf0\xbf\xc4i\x83Ov(\x1a\xd8\x00\x00\x00\x00IEND\xaeB`\x82"""
open('iteam-installer-gui.glade','w').write(glade_file)
open('iteam-installer-png.png','w').write(iteam_png)
	
workQueue = Queue.Queue()
should_quit = False
is_working = False
go = threading.Event()

class appGui():
	def __init__(self):
		gladefile = 'iteam-installer-gui.glade'
		self.windowname = 'gtkbench'
		self.wTree = gtk.glade.XML(gladefile)
		
		#find the arch, x86_64 or i386
		input,output=os.popen4('uname -m')
		self.arch = '32' #the default
		if output.read().strip() == 'x86_64':
			self.arch = '64'

		dic = { 'download' : self.download, 'compile' : self.compilex, 'run' : self.run, 'quit' : self.exit}
		# use compilex because compile is a special word
		self.wTree.signal_autoconnect(dic)

		self.btndownload = self.wTree.get_widget('btndownload')
		self.btncompile = self.wTree.get_widget('btncompile')
		self.btnrun = self.wTree.get_widget('btnrun')
		global progressbar
		progressbar = self.wTree.get_widget('progressbar')
		
		#gobject.timeout_add(100,self.pulse)
		
	def download(self,widget):
		work((os.system,'rm -rf iteam-src'))
		work((os.system,'mkdir iteam-src'))
		work((os.chdir,'iteam-src'))
		work((os.system,'svn co https://i-team.svn.sourceforge.net/svnroot/i-team/trunk iteam'))
		work((os.system,'svn co https://gamepower.svn.sourceforge.net/svnroot/gamepower/GP2D/trunk gp2d'))
		work((os.chdir,'..'))

	def compilex(self,widget):
		work((os.chdir,'iteam-src'))
		work((os.chdir,'gp2d'))
		work((os.system,'make linux' + self.arch))
		work((os.chdir,'../iteam'))
		work((os.system,'cp ../gp2d/libgp2d.so ./'))
		work((os.system,'make linux' + self.arch))
		work((os.chdir,'../..'))

	def run(self,widget):
		#work((os.chdir,'iteam-src'))
		#work((os.chdir,'iteam'))
		#work((os.system,'chmod 755 run'))
		work((os.system,'./run'))
		work((os.chdir,'../..'))
		#os.spawnlp(os.P_NOWAIT, './run', './run')

	def exit(self,widget,event=None):
		global should_quit
		should_quit = True
		os.system('rm iteam-installer-png.png iteam-installer-gui.glade')
		sys.exit(0)
		
def work(command):
	workQueue.put(command)
		
class Runner(threading.Thread):
	def __init__(self,workQueue):
		threading.Thread.__init__(self)
		self.workQueue = workQueue
	def run(self):
		while True and not should_quit:
			global is_working
			item = self.workQueue.get(True) #block until there is an item
			is_working = True
			item[0](item[1]) #run the function with the passed arguments
			is_working = False

class Pulsar(threading.Thread):
	def __init__(self):
		threading.Thread.__init__(self)
	def run(self):
		while not should_quit:
			if (not workQueue.empty() or is_working):
				progressbar.pulse()
				time.sleep(.1)

worker = Runner(workQueue)
worker.start()
progress_bar_pulser = Pulsar()
progress_bar_pulser.start()

#start the app
app = appGui()
gtk.main()
